<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Detective - Knowledge Graph (36 nodes)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            display: flex;
            flex-direction: column;
        }
        
        /* Compact header */
        header {
            background: linear-gradient(135deg, #161b22 0%, #0d1117 100%);
            color: white;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            flex-shrink: 0;
            border-bottom: 1px solid #30363d;
        }
        header h1 { 
            font-size: 1rem; 
            font-weight: 600;
            color: #58a6ff;
        }
        .stats {
            display: flex;
            gap: 0.75rem;
            font-size: 0.75rem;
        }
        .stat {
            background: rgba(88,166,255,0.15);
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            border: 1px solid rgba(88,166,255,0.3);
        }
        .stat-value { font-weight: 700; color: #58a6ff; }
        
        /* Controls bar - more compact */
        .controls {
            background: #161b22;
            padding: 0.4rem 1rem;
            display: flex;
            gap: 0.5rem;
            align-items: center;
            border-bottom: 1px solid #30363d;
            flex-shrink: 0;
            flex-wrap: wrap;
        }
        .controls button {
            padding: 0.35rem 0.7rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.15s;
        }
        .controls button:hover {
            transform: translateY(-1px);
        }
        .btn-zoom {
            background: #238636;
            color: white;
        }
        .btn-zoom:hover {
            background: #2ea043;
        }
        .btn-secondary {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }
        .btn-secondary:hover {
            background: #30363d;
        }
        .btn-fit {
            background: #1f6feb;
            color: white;
        }
        .btn-fit:hover {
            background: #388bfd;
        }
        .zoom-display {
            background: #0d1117;
            color: #58a6ff;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.75rem;
            min-width: 55px;
            text-align: center;
            border: 1px solid #30363d;
        }
        .separator {
            width: 1px;
            height: 20px;
            background: #30363d;
            margin: 0 0.25rem;
        }
        .hint {
            margin-left: auto;
            color: #8b949e;
            font-size: 0.7rem;
        }
        .zoom-slider {
            width: 100px;
            height: 4px;
            -webkit-appearance: none;
            background: #30363d;
            border-radius: 2px;
            outline: none;
        }
        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #58a6ff;
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* Main diagram area - full viewport */
        .diagram-wrapper {
            flex: 1;
            overflow: auto;
            background: #0d1117;
            cursor: grab;
            position: relative;
        }
        .diagram-wrapper:active {
            cursor: grabbing;
        }
        .diagram-container {
            display: inline-block;
            padding: 1rem;
            min-width: 100%;
            min-height: 100%;
            transform-origin: 0 0;
            transition: transform 0.05s ease-out;
        }
        .mermaid {
            background: #161b22;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            display: inline-block;
            border: 1px solid #30363d;
        }
        .mermaid svg {
            max-width: none !important;
            height: auto !important;
        }
        /* Style the SVG nodes for dark theme */
        .mermaid .node rect, .mermaid .node polygon {
            fill: #21262d !important;
            stroke: #58a6ff !important;
        }
        .mermaid .node .label {
            color: #c9d1d9 !important;
        }
        .mermaid .edgePath path {
            stroke: #8b949e !important;
        }
        .mermaid .edgeLabel {
            background-color: #161b22 !important;
            color: #8b949e !important;
        }
        
        /* Floating Legend - collapsible */
        .legend {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: #161b22;
            padding: 0.6rem;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            font-size: 0.7rem;
            z-index: 100;
            border: 1px solid #30363d;
            max-width: 140px;
        }
        .legend h3 { 
            margin-bottom: 0.4rem; 
            color: #58a6ff; 
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
        }
        .legend-item { 
            display: flex; 
            align-items: center; 
            gap: 0.4rem; 
            margin: 0.2rem 0;
            color: #8b949e;
        }
        .legend-shape { 
            width: 14px; 
            height: 10px; 
            border: 1.5px solid #58a6ff; 
            background: #21262d;
        }
        .shape-rect { border-radius: 2px; }
        .shape-rounded { border-radius: 4px; }
        .shape-parallelogram { transform: skewX(-10deg); width: 18px; }
        
        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #8b949e;
            font-size: 1rem;
            gap: 1rem;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #30363d;
            border-top-color: #58a6ff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Quick zoom panel */
        .quick-zoom {
            position: fixed;
            left: 15px;
            bottom: 15px;
            background: #161b22;
            padding: 0.5rem;
            border-radius: 6px;
            border: 1px solid #30363d;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            z-index: 100;
        }
        .quick-zoom button {
            width: 32px;
            height: 32px;
            border: none;
            background: #21262d;
            color: #c9d1d9;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quick-zoom button:hover {
            background: #30363d;
        }
    </style>
</head>
<body>
    <header>
        <h1>ðŸ“Š Financial Detective - Knowledge Graph</h1>
        <div class="stats">
            <div class="stat"><span class="stat-value">36</span> Nodes</div>
            <div class="stat"><span class="stat-value">37</span> Relationships</div>
        </div>
    </header>
    
    <div class="controls">
        <button class="btn-zoom" onclick="zoomIn()">+ Zoom In</button>
        <button class="btn-zoom" onclick="zoomOut()">âˆ’ Zoom Out</button>
        <input type="range" class="zoom-slider" id="zoomSlider" min="5" max="200" value="100" oninput="setZoomFromSlider(this.value)">
        <span class="zoom-display" id="zoomLevel">100%</span>
        <div class="separator"></div>
        <button class="btn-fit" onclick="fitToScreen()">âŠ¡ Fit to Screen</button>
        <button class="btn-secondary" onclick="resetZoom()">â†º Reset 100%</button>
        <div class="separator"></div>
        <button class="btn-secondary" onclick="setZoom(0.1)">10%</button>
        <button class="btn-secondary" onclick="setZoom(0.25)">25%</button>
        <button class="btn-secondary" onclick="setZoom(0.5)">50%</button>
        <span class="hint">Drag to pan â€¢ Ctrl+Scroll to zoom â€¢ Arrow keys to navigate</span>
    </div>
    
    <div class="quick-zoom">
        <button onclick="zoomIn()" title="Zoom In">+</button>
        <button onclick="zoomOut()" title="Zoom Out">âˆ’</button>
        <button onclick="fitToScreen()" title="Fit to Screen">âŠ¡</button>
        <button onclick="resetZoom()" title="Reset to 100%">â†º</button>
    </div>
    
    <div class="diagram-wrapper" id="wrapper">
        <div class="diagram-container" id="container">
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div>Rendering 36 nodes...</div>
            </div>
            <pre class="mermaid" id="diagram" style="display:none;">
flowchart LR

    %% Node definitions
    company_1["Reliance Industries Limited (Parent holding company of the Reliance Group)"]
    company_2["Reliance Retail Limited (Subsidiary of Reliance Industries Limited)"]
    amount_1[/"Gross revenue of Reliance Retail in FY 2024-25: â‚¹3,30,870 crore"/]
    amount_2[/"EBITDA of Reliance Retail in FY 2024-25: â‚¹25,094 crore"/]
    company_3["Jio Platforms Limited (Subsidiary of Reliance Industries Limited)"]
    amount_3[/"Revenue of Digital Services segment in FY 2024-25: â‚¹1,54,119 crore"/]
    amount_4[/"Revenue of Digital Services segment in FY 2024-25: US$18.0 billion"/]
    amount_5[/"EBITDA of Digital Services segment in FY 2024-25: â‚¹65,001 crore"/]
    amount_6[/"EBITDA of Digital Services segment in FY 2024-25: US$7.6 billion"/]
    company_4["Network18 Media and Investments Limited (Majority-owned subsidiary of Relianc..."]
    company_5["Viacom18 Media Pvt. Ltd. (Subsidiary of Reliance Industries Limited)"]
    company_6["bp (Partner in Jio-bp joint venture)"]
    company_7["Jio-bp (Fuel retail and mobility joint venture between Reliance I...)"]
    amount_7[/"Consolidated revenue of Reliance Industries Limited in FY...: â‚¹10,71,174 crore"/]
    amount_8[/"Consolidated revenue of Reliance Industries Limited in FY...: US$ 125.3 billion"/]
    amount_9[/"EBITDA of Reliance Industries Limited in FY 2024-25: â‚¹1,83,422 crore"/]
    amount_10[/"Net profit attributable to shareholders of Reliance Indus...: â‚¹81,309 crore"/]
    amount_11[/"Capital expenditure during FY 2024-25: â‚¹1,31,000 crore"/]
    risk_1("market volatility (Affecting consumer demand and margins)")
    risk_2("geopolitical uncertainties (Impacting global energy markets and supply chains)")
    risk_3("regulatory and policy changes (Affecting telecommunications, energy, and reta...")
    risk_4("Competitive intensity (Across digital services, retail, and energy segments)")
    risk_5("Execution risks (Related to large-scale capital expenditure projects)")
    risk_6("macroeconomic risks (Including global economic slowdown, geopolitical tensions)")
    amount_12[/"Gross revenue of Reliance Retail Limited in FY 2024-25: â‚¹3,30,943 crore"/]
    amount_13[/"Revenue of Media and Entertainment segment in FY 2024-25: â‚¹20,696 crore"/]
    amount_14[/"EBITDA of Media and Entertainment segment in FY 2024-25: â‚¹1,833 crore"/]
    risk_7("content cost inflation (Impacting Media and Entertainment segment)")
    risk_8("advertising market cyclicality (Impacting Media and Entertainment segment)")
    risk_9("technological disruption (Impacting Media and Entertainment segment)")
    amount_15[/"Revenue of Oil to Chemicals segment in FY 2024-25: â‚¹6,26,921 crore"/]
    amount_16[/"EBITDA of Oil to Chemicals segment in FY 2024-25: â‚¹54,988 crore"/]
    risk_10("global crude price volatility (Impacting Oil to Chemicals segment)")
    risk_11("refining margin fluctuations (Impacting Oil to Chemicals segment)")
    risk_12("geopolitical risks (Impacting Oil to Chemicals segment)")
    amount_17[/"Capital expenditure committed during FY 2024-25: â‚¹1,31,107 crore"/]

    %% Relationships
    company_1 -->|OWNS| company_2
    company_1 -->|OWNS| company_3
    company_1 -->|OWNS| company_4
    company_1 -->|OWNS| company_5
    company_1 -->|REPORTS_AMOUNT| amount_7
    company_1 -->|REPORTS_AMOUNT| amount_8
    company_1 -->|REPORTS_AMOUNT| amount_9
    company_1 -->|REPORTS_AMOUNT| amount_10
    company_1 -->|REPORTS_AMOUNT| amount_11
    company_1 -->|HAS_RISK| risk_1
    company_1 -->|HAS_RISK| risk_2
    company_1 -->|HAS_RISK| risk_3
    company_1 -->|HAS_RISK| risk_4
    company_1 -->|HAS_RISK| risk_5
    company_1 -->|HAS_RISK| risk_6
    company_1 -->|JOINT_VENTURE_WITH| company_7
    company_1 -->|COMMITTED_CAPEX| amount_17
    company_2 -->|REPORTS_AMOUNT| amount_1
    company_2 -->|REPORTS_AMOUNT| amount_2
    company_2 -->|REPORTS_AMOUNT| amount_12
    company_2 -->|HAS_RISK| risk_6
    company_3 -->|REPORTS_AMOUNT| amount_3
    company_3 -->|REPORTS_AMOUNT| amount_4
    company_3 -->|REPORTS_AMOUNT| amount_5
    company_3 -->|REPORTS_AMOUNT| amount_6
    company_7 -->|PARTNERED_WITH| company_6
    company_1 -->|PARTNERED_WITH| company_6
    company_4 -->|HAS_RISK| risk_7
    company_4 -->|HAS_RISK| risk_8
    company_4 -->|HAS_RISK| risk_9
    company_4 -->|REPORTS_AMOUNT| amount_13
    company_4 -->|REPORTS_AMOUNT| amount_14
    company_1 -->|HAS_RISK| risk_10
    company_1 -->|HAS_RISK| risk_11
    company_1 -->|HAS_RISK| risk_12
    company_1 -->|REPORTS_AMOUNT| amount_15
    company_1 -->|REPORTS_AMOUNT| amount_16
            </pre>
        </div>
    </div>
    
    <div class="legend">
        <h3>Node Types</h3>
        <div class="legend-item"><div class="legend-shape shape-rect"></div><span>Company</span></div>
        <div class="legend-item"><div class="legend-shape shape-rounded"></div><span>Risk Factor</span></div>
        <div class="legend-item"><div class="legend-shape shape-parallelogram"></div><span>Dollar Amount</span></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        let zoom = 1;
        const minZoom = 0.05;
        const maxZoom = 2;
        const zoomStep = 0.05;
        
        const wrapper = document.getElementById('wrapper');
        const container = document.getElementById('container');
        const loading = document.getElementById('loading');
        const diagram = document.getElementById('diagram');
        const zoomSlider = document.getElementById('zoomSlider');
        
        // Initialize Mermaid with dark theme
        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            maxTextSize: 2000000,
            maxEdges: 20000,
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                nodeSpacing: 20,
                rankSpacing: 40,
                padding: 15
            },
            themeVariables: {
                fontSize: '10px',
                primaryColor: '#21262d',
                primaryTextColor: '#c9d1d9',
                primaryBorderColor: '#58a6ff',
                lineColor: '#8b949e',
                secondaryColor: '#30363d',
                tertiaryColor: '#161b22'
            }
        });
        
        // Render the diagram
        async function renderDiagram() {
            try {
                const content = diagram.textContent.trim();
                const { svg } = await mermaid.render('rendered-graph', content);
                diagram.innerHTML = svg;
                diagram.style.display = 'block';
                loading.style.display = 'none';
                
                // Auto-fit to screen after render with slight delay
                setTimeout(() => {
                    fitToScreen();
                    wrapper.scrollTo(0, 0);
                }, 200);
            } catch (e) {
                loading.innerHTML = '<div style="color:#f85149;">Error rendering: ' + e.message + '</div><div style="margin-top:1rem;font-size:0.8rem;color:#8b949e;">Try refreshing the page or use a different browser.</div>';
            }
        }
        
        // Update zoom display and slider
        function updateZoom() {
            container.style.transform = `scale(${zoom})`;
            const percent = Math.round(zoom * 100);
            document.getElementById('zoomLevel').textContent = percent + '%';
            zoomSlider.value = percent;
        }
        
        // Set zoom directly
        function setZoom(newZoom) {
            zoom = Math.max(minZoom, Math.min(maxZoom, newZoom));
            updateZoom();
        }
        
        // Set zoom from slider
        function setZoomFromSlider(value) {
            setZoom(value / 100);
        }
        
        function zoomIn() {
            const step = zoom < 0.2 ? 0.02 : (zoom < 0.5 ? 0.05 : 0.1);
            setZoom(zoom + step);
        }
        
        function zoomOut() {
            const step = zoom < 0.2 ? 0.02 : (zoom < 0.5 ? 0.05 : 0.1);
            setZoom(zoom - step);
        }
        
        function resetZoom() {
            zoom = 1;
            updateZoom();
            wrapper.scrollTo(0, 0);
        }
        
        function fitToScreen() {
            const svg = diagram.querySelector('svg');
            if (!svg) return;
            
            const bbox = svg.getBBox ? svg.getBBox() : null;
            const svgWidth = bbox ? bbox.width : (svg.viewBox?.baseVal?.width || svg.clientWidth);
            const svgHeight = bbox ? bbox.height : (svg.viewBox?.baseVal?.height || svg.clientHeight);
            
            const wrapperWidth = wrapper.clientWidth - 40;
            const wrapperHeight = wrapper.clientHeight - 40;
            
            const scaleX = wrapperWidth / svgWidth;
            const scaleY = wrapperHeight / svgHeight;
            
            zoom = Math.max(minZoom, Math.min(scaleX, scaleY, 1));
            
            updateZoom();
            
            setTimeout(() => {
                const containerWidth = container.scrollWidth * zoom;
                const containerHeight = container.scrollHeight * zoom;
                const scrollX = Math.max(0, (containerWidth - wrapperWidth) / 2);
                const scrollY = Math.max(0, (containerHeight - wrapperHeight) / 2);
                wrapper.scrollTo(scrollX, scrollY);
            }, 50);
        }
        
        // Scroll navigation
        function scrollTo(direction) {
            const amount = 300;
            switch(direction) {
                case 'left': wrapper.scrollBy(-amount, 0); break;
                case 'right': wrapper.scrollBy(amount, 0); break;
                case 'top': wrapper.scrollBy(0, -amount); break;
                case 'bottom': wrapper.scrollBy(0, amount); break;
            }
        }
        
        // Mouse wheel zoom (with Ctrl or Meta key)
        wrapper.addEventListener('wheel', (e) => {
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -1 : 1;
                const step = zoom < 0.2 ? 0.01 : (zoom < 0.5 ? 0.02 : 0.05);
                setZoom(zoom + (delta * step));
            }
        }, { passive: false });
        
        // Drag to pan
        let isDragging = false;
        let startX, startY, scrollLeft, scrollTop;
        
        wrapper.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.pageX - wrapper.offsetLeft;
            startY = e.pageY - wrapper.offsetTop;
            scrollLeft = wrapper.scrollLeft;
            scrollTop = wrapper.scrollTop;
            wrapper.style.cursor = 'grabbing';
        });
        
        wrapper.addEventListener('mouseleave', () => {
            isDragging = false;
            wrapper.style.cursor = 'grab';
        });
        
        wrapper.addEventListener('mouseup', () => {
            isDragging = false;
            wrapper.style.cursor = 'grab';
        });
        
        wrapper.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            const x = e.pageX - wrapper.offsetLeft;
            const y = e.pageY - wrapper.offsetTop;
            wrapper.scrollLeft = scrollLeft - (x - startX);
            wrapper.scrollTop = scrollTop - (y - startY);
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            
            const scrollAmount = e.shiftKey ? 200 : 50;
            
            switch(e.key) {
                case '+': case '=': zoomIn(); e.preventDefault(); break;
                case '-': case '_': zoomOut(); e.preventDefault(); break;
                case '0': resetZoom(); e.preventDefault(); break;
                case 'f': case 'F': fitToScreen(); e.preventDefault(); break;
                case 'ArrowLeft': wrapper.scrollBy(-scrollAmount, 0); e.preventDefault(); break;
                case 'ArrowRight': wrapper.scrollBy(scrollAmount, 0); e.preventDefault(); break;
                case 'ArrowUp': wrapper.scrollBy(0, -scrollAmount); e.preventDefault(); break;
                case 'ArrowDown': wrapper.scrollBy(0, scrollAmount); e.preventDefault(); break;
                case 'Home': wrapper.scrollTo(0, 0); e.preventDefault(); break;
                case 'End': wrapper.scrollTo(wrapper.scrollWidth, wrapper.scrollHeight); e.preventDefault(); break;
            }
        });
        
        // Touch support for mobile
        let touchStartX, touchStartY;
        wrapper.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                touchStartX = e.touches[0].pageX;
                touchStartY = e.touches[0].pageY;
            }
        }, { passive: true });
        
        wrapper.addEventListener('touchmove', (e) => {
            if (e.touches.length === 1) {
                const dx = touchStartX - e.touches[0].pageX;
                const dy = touchStartY - e.touches[0].pageY;
                wrapper.scrollBy(dx, dy);
                touchStartX = e.touches[0].pageX;
                touchStartY = e.touches[0].pageY;
            }
        }, { passive: true });
        
        // Start rendering
        renderDiagram();
    </script>
</body>
</html>
